$(function(){Parse.$=jQuery,Parse.initialize("fqHhc846ZUO9Oel0sZ2CJHZoZQZmo6UXi2TCD46V","anCCyJpsOEUKBqrhEtiJYuKOOoOulvhKtvZnhIOn");var e=$(".main-container"),t=($(".blog-sidebar"),Parse.Object.extend("Blog",{update:function(e){if(!this.get("ACL")){var t=new Parse.ACL(Parse.User.current());t.setPublicReadAccess(!0),this.setACL(t)}var n=new r;n.id=e.category,this.set({title:e.title,category:n,summary:e.summary,content:e.content,author:this.get("author")||Parse.User.current(),authorName:this.get("authorName")||Parse.User.current().get("username"),time:this.get("time")||(new Date).toDateString()}).save(null,{success:function(e){h.navigate("#/admin",{trigger:!0})},error:function(e,t){console.log(e),console.log(t)}})}})),n=Parse.Object.extend("Comment",{add:function(e){this.set({blog:e.blog,authorName:e.authorName,email:e.email,content:e.content}).save(null,{success:function(e){window.location.reload()},error:function(e,t){console.log(blog),console.log(t)}})}}),r=Parse.Object.extend("Category",{update:function(e){if(!this.get("ACL")){var t=new Parse.ACL(Parse.User.current());t.setPublicReadAccess(!0),this.setACL(t)}var n=new r;n.id=e.category,this.set({name:e.name,url:e.name.toString().toLowerCase()}).save(null,{success:function(e){h.navigate("#/admin",{trigger:!0})},error:function(e,t){console.log(blog),console.log(t)}})}}),o=Parse.Collection.extend({model:t,query:new Parse.Query(t).descending("createdAt")}),i=Parse.Collection.extend({model:r}),a=Parse.View.extend({template:Handlebars.compile($("#blog-tpl").html()),events:{"submit .form-comment":"submit"},submit:function(e){e.preventDefault();var t=$(e.target).serializeArray(),r=new n;r.add({blog:this.model,authorName:t[0].value,email:t[1].value,content:t[2].value})},render:function(){var e=this,t=this.model.toJSON(),r=new Parse.Query(n).equalTo("blog",this.model).descending("createdAt"),o=r.collection();o.fetch().then(function(n){t.comment=n.toJSON(),e.$el.html(e.template(t))})}}),l=Parse.View.extend({template:Handlebars.compile($("#blogs-tpl").html()),render:function(){var e={blog:this.collection.toJSON()};this.$el.html(this.template(e))}}),s=Parse.View.extend({template:Handlebars.compile($("#categories-tpl").html()),render:function(){var e={category:this.collection.toJSON()};this.$el.html(this.template(e))}}),c=Parse.View.extend({template:Handlebars.compile($("#login-tpl").html()),events:{"submit .form-signin":"login"},login:function(e){e.preventDefault();var t=$(e.target).serializeArray(),n=t[0].value,r=t[1].value;Parse.User.logIn(n,r,{success:function(e){h.navigate("#/admin",{trigger:!0})},error:function(e,t){console.log(t)}})},render:function(){this.$el.html(this.template())}}),u=Parse.View.extend({template:Handlebars.compile($("#admin-tpl").html()),render:function(){var e={username:this.options.username,blog:this.collection.toJSON()};this.$el.html(this.template(e))}}),g=Parse.View.extend({template:Handlebars.compile($("#write-tpl").html()),events:{"submit .form-write":"submit"},submit:function(e){e.preventDefault();var n=$(e.target).serializeArray();this.model=this.model||new t,this.model.update({title:n[0].value,category:n[1].value,summary:n[2].value,content:n[3].value})},render:function(){var e;this.model?(e=this.model.toJSON(),e.form_title="Edit Blog"):e={form_title:"Add a Blog",title:"",summary:"",content:""};var t=this,n=new i;n.fetch().then(function(n){e.categories=n.toJSON(),e.category&&e.categories.forEach(function(t,n){t==e.category&&(e.categories[n].selected=!0)}),console.log(e),t.$el.html(t.template(e)).find(".write-content").wysihtml5()})}}),m=Parse.View.extend({template:Handlebars.compile($("#write-tpl-cat").html()),events:{"submit .form-write":"submit"},submit:function(e){e.preventDefault();var t=$(e.target).serializeArray();this.model=this.model||new r,this.model.update({name:t[0].value,url:t[0].value.toString().toLowerCase()})},render:function(){var e;this.model?(e=this.model.toJSON(),e.form_title="Category Blog"):e={form_title:"Add a Category",title:"",summary:"",content:""},this.$el.html(this.template(e)).find(".write-content").wysihtml5()}}),d=Parse.Router.extend({initialize:function(e){this.blogs=new o,this.categories=new i},start:function(){Parse.history.start({root:"/"}),this.categories.fetch().then(function(e){var t=new s({collection:e});t.render(),$(".blog-sidebar").html(t.el)})},routes:{"":"index","blog/:id":"blog",admin:"admin",login:"login",add:"add",add_category:"add_category","edit/:id":"edit","del/:id":"del",logout:"logout","category/:id":"category"},index:function(){this.blogs.fetch({success:function(t){var n=new l({collection:t});n.render(),e.html(n.el)},error:function(e,t){console.log(t)}})},category:function(n){var o=new Parse.Query(r);o.get(n,{success:function(n){var r=new Parse.Query(t).equalTo("category",n).descending("createdAt");collection=r.collection(),collection.fetch().then(function(t){var n=new l({collection:t});n.render(),e.html(n.el)})},error:function(e,t){console.log(t)}})},blog:function(n){var r=new Parse.Query(t);r.get(n,{success:function(t){var n=new a({model:t});n.render(),e.html(n.el)},error:function(e,t){console.log(t)}})},admin:function(){var t=Parse.User.current();t?this.blogs.fetch({success:function(n){var r=new u({username:t.get("username"),collection:n});r.render(),e.html(r.el)},error:function(e,t){console.log(t)}}):this.navigate("#/login",{trigger:!0})},login:function(){var t=new c;t.render(),e.html(t.el)},add:function(){if(Parse.User.current()){var t=new g;t.render(),e.html(t.el)}else this.navigate("#/login",{trigger:!0})},add_category:function(){if(Parse.User.current()){var t=new m;t.render(),e.html(t.el)}else this.navigate("#/login",{trigger:!0})},edit:function(n){if(Parse.User.current()){var r=new Parse.Query(t);r.get(n,{success:function(t){var n=new g({model:t});n.render(),e.html(n.el)},error:function(e,t){console.log(t)}})}else this.navigate("#/login",{trigger:!0})},edit_cat:function(t){if(Parse.User.current()){var n=new Parse.Query(r);n.get(t,{success:function(t){var n=new m({model:t});n.render(),e.html(n.el)},error:function(e,t){console.log(t)}})}else this.navigate("#/login",{trigger:!0})},del:function(e){if(Parse.User.current()){var n=this,r=new Parse.Query(t);r.get(e).then(function(e){e.destroy().then(function(e){n.navigate("admin",{trigger:!0})})})}else this.navigate("#/login",{trigger:!0})},del_cat:function(e){if(Parse.User.current()){var t=this,n=new Parse.Query(r);n.get(e).then(function(e){e.destroy().then(function(e){t.navigate("admin",{trigger:!0})})})}else this.navigate("#/login",{trigger:!0})},logout:function(){Parse.User.logOut(),this.navigate("#/login",{trigger:!0})}}),h=new d;h.start()});